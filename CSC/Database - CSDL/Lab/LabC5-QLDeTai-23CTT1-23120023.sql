/*
Phần 1: Ghi chú thông tin sinh viên
- MSSV: 23120023
- Họ tên: Nguyễn Thái Bảo
- Email: 23120023@student.hcmus.edu.vn
- Ngày làm bài: 29/3/2025
*/

-- Phần 2: Tạo CSDL
CREATE DATABASE DB_QLDeTai_23120023
GO
USE DB_QLDeTai_23120023
GO

-- Phần 3: Tạo schema
CREATE TABLE GIAOVIEN
(
	MAGV CHAR(3),
	HOTEN NVARCHAR(50),
	LUONG DECIMAL(5,1),
	PHAI NVARCHAR(3),
	NGSINH DATE,
	DIACHI NVARCHAR(100),
	GVQLCM CHAR(3),
	MABM NVARCHAR(4)

	PRIMARY KEY (MAGV)
)

CREATE TABLE GV_DT
(
	MAGV CHAR(3),
	DIENTHOAI VARCHAR(10)

	PRIMARY KEY (MAGV, DIENTHOAI)
)

CREATE TABLE BOMON
(
	MABM NVARCHAR(4),
	TENBM NVARCHAR(50),
	PHONG CHAR(3),
	DIENTHOAI VARCHAR(10),
	TRUONGBM CHAR(3),
	MAKHOA VARCHAR(4),
	NGAYNHANCHUC DATE,

	PRIMARY KEY (MABM)
)

CREATE TABLE KHOA
(
	MAKHOA VARCHAR(4),
	TENKHOA NVARCHAR(50),
	NAMTL INT,
	PHONG CHAR(3),
	DIENTHOAI VARCHAR(10),
	TRUONGKHOA CHAR(3),
	NGAYNHANCHUC DATE,

	PRIMARY KEY (MAKHOA)
)

CREATE TABLE DETAI
(
	MADT CHAR(3),
	TENDT NVARCHAR(100),
	CAPQL NVARCHAR(20),
	KINHPHI DECIMAL(5,1),
	NGAYBD DATE,
	NGAYKT DATE,
	MACD NCHAR(4),
	GVCNDT CHAR(3),

	PRIMARY KEY (MADT)
)

CREATE TABLE CHUDE
(
	MACD NCHAR(4),
	TENCD NVARCHAR(50)

	PRIMARY KEY (MACD)
)

CREATE TABLE CONGVIEC
(
	MADT CHAR(3),
	SOTT INT,
	TENCV NVARCHAR(50),
	NGAYBD DATE,
	NGAYKT DATE

	PRIMARY KEY (MADT, SOTT)
)

CREATE TABLE THAMGIADT
(
	MAGV CHAR(3),
	MADT CHAR(3),
	STT INT,
	PHUCAP DECIMAL(2,1),
	KETQUA NVARCHAR(5)

	PRIMARY KEY (MAGV, MADT, STT)
)

CREATE TABLE NGUOITHAN
(
	MAGV CHAR(3),
	TEN NVARCHAR(15),
	NGSINH DATE,
	PHAI NVARCHAR(3)

	PRIMARY KEY (MAGV, TEN)
)

-- TAO RANG BUOC

-- GIAOVIEN
ALTER TABLE GIAOVIEN
	ADD CONSTRAINT FK_GIAOVIEN_GVQL
	FOREIGN KEY (GVQLCM)
	REFERENCES GIAOVIEN(MAGV)

ALTER TABLE GIAOVIEN
	ADD CONSTRAINT FK_GIAOVIEN_BOMON
	FOREIGN KEY (MABM)
	REFERENCES BOMON(MABM)

ALTER TABLE GIAOVIEN
	ADD CONSTRAINT C_GV_PHAI
	CHECK (PHAI IN ('Nam', N'Nữ'))

ALTER TABLE GIAOVIEN
	ADD CONSTRAINT C_GV_NGSINH
	CHECK (NGSINH < GETDATE())

ALTER TABLE GIAOVIEN
	ADD CONSTRAINT C_GV_LUONG
	CHECK (LUONG >= 0)

-- GV_DT
ALTER TABLE GV_DT
	ADD CONSTRAINT FK_GV_DT_GIAOVIEN
	FOREIGN KEY (MAGV)
	REFERENCES GIAOVIEN(MAGV)

-- BOMON
ALTER TABLE BOMON
	ADD CONSTRAINT FK_BOMON_GIAOVIEN
	FOREIGN KEY (TRUONGBM)
	REFERENCES GIAOVIEN(MAGV)

ALTER TABLE BOMON
	ADD CONSTRAINT FK_BOMON_KHOA
	FOREIGN KEY (MAKHOA)
	REFERENCES KHOA(MAKHOA)

ALTER TABLE BOMON
	ADD CONSTRAINT C_BM_NGAY
	CHECK (NGAYNHANCHUC < GETDATE())

-- KHOA
ALTER TABLE KHOA
	ADD CONSTRAINT FK_KHOA_GIAOVIEN
	FOREIGN KEY (TRUONGKHOA)
	REFERENCES GIAOVIEN(MAGV)

ALTER TABLE KHOA
	ADD CONSTRAINT C_KHOA_NAMTL
	CHECK (NAMTL <= YEAR(GETDATE()))

ALTER TABLE KHOA
	ADD CONSTRAINT C_KHOA_NGAYNHANCHUC
	CHECK (NGAYNHANCHUC < GETDATE())

-- DETAI
ALTER TABLE DETAI
	ADD CONSTRAINT FK_DETAI_CHUDE
	FOREIGN KEY (MACD)
	REFERENCES CHUDE(MACD)

ALTER TABLE DETAI
	ADD CONSTRAINT FK_DETAI_GIAOVIEN
	FOREIGN KEY (GVCNDT)
	REFERENCES GIAOVIEN(MAGV)

ALTER TABLE DETAI
	ADD CONSTRAINT C_DT_KINHPHI
	CHECK (KINHPHI >= 0)

ALTER TABLE DETAI
	ADD CONSTRAINT C_DT_NGBD
	CHECK (NGAYBD <= GETDATE())

ALTER TABLE DETAI
	ADD CONSTRAINT C_DT_NGKT
	CHECK (NGAYKT <= GETDATE())

ALTER TABLE DETAI
	ADD CONSTRAINT C_DT_BD_KT
	CHECK (NGAYBD <= NGAYKT)

-- CHUDE

-- CONGVIEC
ALTER TABLE CONGVIEC
	ADD CONSTRAINT FK_CONGVIEC_DETAI
	FOREIGN KEY (MADT)
	REFERENCES DETAI(MADT)

ALTER TABLE CONGVIEC
	ADD CONSTRAINT C_CV_NGBD
	CHECK (NGAYBD <= GETDATE())

ALTER TABLE CONGVIEC
	ADD CONSTRAINT C_CV_NGKT
	CHECK (NGAYKT <= GETDATE())

ALTER TABLE CONGVIEC
	ADD CONSTRAINT C_CV_BD_KT
	CHECK (NGAYBD <= NGAYKT)

-- THAMGIADT
ALTER TABLE THAMGIADT
	ADD CONSTRAINT FK_THAMGIADT_GIAOVIEN
	FOREIGN KEY (MAGV)
	REFERENCES GIAOVIEN(MAGV)

ALTER TABLE THAMGIADT
	ADD CONSTRAINT FK_THAMGIADT_CONGVIEC
	FOREIGN KEY (MADT, STT)
	REFERENCES CONGVIEC(MADT, SOTT)

ALTER TABLE THAMGIADT
	ADD CONSTRAINT C_TGDT_PHUCAP
	CHECK (PHUCAP >= 0)

-- NGUOITHAN
ALTER TABLE NGUOITHAN
	ADD CONSTRAINT FK_NGUOITHAN_GIAOVIEN
	FOREIGN KEY (MAGV)
	REFERENCES GIAOVIEN(MAGV)

ALTER TABLE NGUOITHAN
	ADD CONSTRAINT C_NGUOITHAN_PHAI
	CHECK (PHAI IN ('Nam', N'Nữ'))

-- Phần 4: Nhập liệu
GO

INSERT INTO GIAOVIEN VALUES ('001', N'Nguyễn Hoài An', 2000, 'Nam', '02/15/1973', N'25/3 Lạc Long Quân, Q.10, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('002', N'Trần Trà Hương', 2500, N'Nữ', '06/20/1960	', N'125 Trần Hưng Đạo, Q.1, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('003', N'Nguyễn Ngọc Ánh', 2200, N'Nữ', '05/11/1975', N'12/21 Võ Văn Ngân Thủ Đức, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('004', N'Trương Nam Sơn', 2300, 'Nam', '06/20/1959', N'215 Lý Thường Kiệt, TP Biên Hòa', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('005', N'Lý Hoàng Hà', 2500, 'Nam', '10/23/1954', N'22/5 Nguyễn Xí, Q.Bình Thạnh, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('006', N'Trần Bạch Tuyết', 1500, N'Nữ', '05/20/1980', N'127 Hùng Vương, TP Mỹ Tho', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('007', N'Nguyễn An Trung', 2100, 'Nam', '06/05/1976', N'234 3/2, TP Biên Hòa', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('008', N'Trần Trung Hiếu', 1800, 'Nam', '08/06/1977', N'22/11 Lý Thường Kiệt, TP Mỹ Tho', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('009', N'Trần Hoàng Nam', 2000, 'Nam', '11/22/1975', N'234 Trấn Não, An Phú, TP HCM', NULL, NULL)
INSERT INTO GIAOVIEN VALUES ('010', N'Phạm Nam Thanh', 1500, 'Nam', '12/12/1980', N'221 Hùng Vương, Q.5, TP HCM', NULL, NULL)
GO

UPDATE GIAOVIEN SET GVQLCM = '002' WHERE MAGV = '003'
UPDATE GIAOVIEN SET GVQLCM = '004' WHERE MAGV = '006'
UPDATE GIAOVIEN SET GVQLCM = '007' WHERE MAGV = '008'
UPDATE GIAOVIEN SET GVQLCM = '001' WHERE MAGV = '009'
UPDATE GIAOVIEN SET GVQLCM = '007' WHERE MAGV = '010'

INSERT INTO KHOA VALUES ('CNTT', N'Công nghệ thông tin', 1995, 'B11', '0838123456', '002', '02/20/2005')
INSERT INTO KHOA VALUES ('HH', N'Hóa học', 1980, 'B41', '0838456456', '007', '10/15/2001')
INSERT INTO KHOA VALUES ('SH', N'Sinh học', 1980, 'B31', '0838454545', '004', '10/11/2000')
INSERT INTO KHOA VALUES ('VL', N'Vật lý', 1976, 'B21', '0838223223', '005', '09/18/2003')

INSERT INTO BOMON VALUES ('CNTT', N'Công nghệ tri thức', 'B15', '0838126126', NULL, 'CNTT', NULL)
INSERT INTO BOMON VALUES ('HHC', N'Hóa hữu cơ', 'B44', '838222222', NULL, 'HH', NULL)
INSERT INTO BOMON VALUES ('HL', N'Hóa lý', 'B42', '0838878787', NULL, 'HH', NULL)
INSERT INTO BOMON VALUES ('HPT', N'Hóa phân tích', 'B43', '0838777777', '007', 'HH', '10/15/2007')
INSERT INTO BOMON VALUES ('HTTT', N'Hệ thống thông tin', 'B13', '0838125125', '002', 'CNTT', '09/20/2004')
INSERT INTO BOMON VALUES ('MMT', N'Mạng máy tính', 'B16', '0838676767', '001', 'CNTT', '05/15/2005')
INSERT INTO BOMON VALUES ('SH', N'Sinh hóa', 'B33', '0838898989', NULL, 'SH', NULL)
INSERT INTO BOMON VALUES ('VLĐT', N'Vật lý điện tử', 'B23', '0838234234', NULL, 'VL', NULL)
INSERT INTO BOMON VALUES ('VLƯD', N'Vật lý ứng dụng', 'B24', '0838454545', '005', 'VL', '02/18/2006')
INSERT INTO BOMON VALUES ('VS', N'Vi sinh', 'B32', '0838909090', '004', 'SH', '01/01/2007')

UPDATE GIAOVIEN SET MABM = 'MMT' WHERE MAGV = '001'
UPDATE GIAOVIEN SET MABM = 'HTTT' WHERE MAGV = '002'
UPDATE GIAOVIEN SET MABM = 'HTTT' WHERE MAGV = '003'
UPDATE GIAOVIEN SET MABM = 'VS' WHERE MAGV = '004'
UPDATE GIAOVIEN SET MABM = 'VLĐT' WHERE MAGV = '005'
UPDATE GIAOVIEN SET MABM = 'VS' WHERE MAGV = '006'
UPDATE GIAOVIEN SET MABM = 'HPT' WHERE MAGV = '007'
UPDATE GIAOVIEN SET MABM = 'HPT' WHERE MAGV = '008'
UPDATE GIAOVIEN SET MABM = 'MMT' WHERE MAGV = '009'
UPDATE GIAOVIEN SET MABM = 'HPT' WHERE MAGV = '010'

INSERT INTO CHUDE VALUES ('NCPT', N'Nghiên cứu phát triển')
INSERT INTO CHUDE VALUES ('QLGD', N'Quản lý giáo dục')
INSERT INTO CHUDE VALUES ('ƯDCN', N'Ứng dụng công nghệ')

INSERT INTO DETAI VALUES ('001', N'HTTT quản lý các trường ĐH', N'ĐHQG', 20, '10/20/2007', '10/20/2008', 'QLGD', '002')
INSERT INTO DETAI VALUES ('002', N'HTTT quản lý giáo vụ cho một khoa', N'Trường', 20, '10/12/2000', '10/12/2001', 'QLGD', '002')
INSERT INTO DETAI VALUES ('003', N'Nghiên cứu chế tạo sợi Nanô Platin', N'ĐHQG', 300, '05/15/2008', '05/15/2010', 'NCPT', '005')
INSERT INTO DETAI VALUES ('004', N'Tạo vật liệu sinh học bằng màng ối người', N'Nhà nước', 100, '01/01/2007', '12/31/2009', 'NCPT', '004')
INSERT INTO DETAI VALUES ('005', N'Ứng dụng hóa học xanh', N'Trường', 200, '10/10/2003', '12/10/2004', 'ƯDCN', '007')
INSERT INTO DETAI VALUES ('006', N'Nghiên cứu tế bào gốc', N'Nhà nước', 4000, '10/20/2006', '10/20/2009', 'NCPT', '004')
INSERT INTO DETAI VALUES ('007', N'HTTT quản lý thư viện ở các trường ĐH', N'Trường', 20, '05/10/2009', '05/10/2010', 'QLGD', '001')

INSERT INTO CONGVIEC VALUES ('001', 1, N'Khởi tạo và Lập kế hoạch', '10/20/2007', '12/20/2008')
INSERT INTO CONGVIEC VALUES ('001', 2, N'Xác định yêu cầu', '12/21/2008', '03/21/2008')
INSERT INTO CONGVIEC VALUES ('001', 3, N'Phân tích hệ thống', '03/22/2008', '05/22/2008')
INSERT INTO CONGVIEC VALUES ('001', 4, N'Thiết kế hệ thống', '05/23/2008', '06/23/2008')
INSERT INTO CONGVIEC VALUES ('001', 5, N'Cài đặt thử nghiệm', '06/24/2008', '10/20/2008')
INSERT INTO CONGVIEC VALUES ('002', 1, N'Khởi tạo và Lập kế hoạch', '05/10/2009', '07/10/2009')
INSERT INTO CONGVIEC VALUES ('002', 2, N'Xác định yêu cầu', '07/11/2009', '10/11/2009')
INSERT INTO CONGVIEC VALUES ('002', 3, N'Phân tích hệ thống', '10/12/2009', '12/20/2009')
INSERT INTO CONGVIEC VALUES ('002', 4, N'Thiết kế hệ thống', '12/21/2009', '03/22/2010')
INSERT INTO CONGVIEC VALUES ('002', 5, N'Cài đặt thử nghiệm', '03/23/2010', '05/10/2010')
INSERT INTO CONGVIEC VALUES ('006', 1, N'Lấy mẫu', '10/20/2006', '02/20/2007')
INSERT INTO CONGVIEC VALUES ('006', 2, N'Nuôi cấy', '02/21/2007', '08/21/2008')

INSERT INTO THAMGIADT VALUES ('001', '001', 1, 0, NULL)
INSERT INTO THAMGIADT VALUES ('001', '002', 2, 2, NULL)
INSERT INTO THAMGIADT VALUES ('002', '001', 4, 2, N'Đạt')
INSERT INTO THAMGIADT VALUES ('003', '001', 1, 1, N'Đạt')
INSERT INTO THAMGIADT VALUES ('003', '001', 2, 0, N'Đạt')
INSERT INTO THAMGIADT VALUES ('003', '001', 4, 1, N'Đạt')
INSERT INTO THAMGIADT VALUES ('003', '002', 2, 0, NULL)
INSERT INTO THAMGIADT VALUES ('004', '006', 1, 0, N'Đạt')
INSERT INTO THAMGIADT VALUES ('004', '006', 2, 1, N'Đạt')
INSERT INTO THAMGIADT VALUES ('006', '006', 2, 1.5, N'Đạt')
INSERT INTO THAMGIADT VALUES ('009', '002', 3, 0.5, NULL)
INSERT INTO THAMGIADT VALUES ('009', '002', 4, 1.5, NULL)

INSERT INTO NGUOITHAN VALUES ('001', N'Hùng', '01/14/1990', 'Nam')
INSERT INTO NGUOITHAN VALUES ('001', N'Thủy', '12/08/1994', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('003', N'Hà', '09/03/1998', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('003', N'Thu', '09/03/1998', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('007', N'Mai', '03/26/2003', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('007', N'Vy', '02/14/2000', N'Nữ')
INSERT INTO NGUOITHAN VALUES ('008', N'Nam', '05/06/1991', 'Nam')
INSERT INTO NGUOITHAN VALUES ('009', N'An', '08/19/1996', 'Nam')
INSERT INTO NGUOITHAN VALUES ('010', N'Nguyệt', '01/14/2006', N'Nữ')

-- KIỂM TRA --
SELECT * FROM GIAOVIEN
SELECT * FROM BOMON
SELECT * FROM KHOA
SELECT * FROM NGUOITHAN
SELECT * FROM CHUDE
SELECT * FROM DETAI
SELECT * FROM CONGVIEC
SELECT * FROM THAMGIADT



































































